---
layout: post
title: Alternative Fibonacci implementation
date: '2010-06-20T02:03:00.000-07:00'
author: Hans Kruse
tags:
- vb.net
modified_time: '2016-08-25T23:37:43.464-07:00'
blogger_id: tag:blogger.com,1999:blog-1516417514149439988.post-960768040121978698
blogger_orig_url: http://hcjkruse.blogspot.com/2010/06/alternative-fibonacci-implementation.html
---

<p>On Scott Hanselman's blog there was another formula for Fibonacci that uses the Goldenratio and some Mathemagic to calculate Fib(n). This formula is more usefull if you want to calculate Fib(n) for a certain n and if you are not interested in the sequence.  I used this formula in an alternative implementation of my FibEnumerable just to test for correctness. </p><pre><span style='color: rgb(51,153,51)'>' Fibonacci.vb created with MonoDevelop </span><br /><span style='color: rgb(51,153,51)'>' User: kruse at 14:10 22-1-2009 </span><br /><span style='color: rgb(51,153,51)'>' </span><br /><span style='color: rgb(51,153,51)'>' To change standard headers go to Edit-&gt;Preferences-&gt;Coding-&gt;Standard Headers </span><br /><span style='color: rgb(51,153,51)'>' </span><br /> <br /><span style='color: rgb(0,0,255)'>Option</span><span style='color: rgb(0,0,0)'> Explicit</span><span style='color: rgb(0,0,255)'> On</span><span style='color: rgb(0,0,0)'> </span><br /><span style='color: rgb(0,0,255)'>Option</span><span style='color: rgb(0,0,0)'> Strict</span><span style='color: rgb(0,0,255)'> On</span><span style='color: rgb(0,0,0)'> </span><br /> <br /><span style='color: rgb(0,0,255)'>Imports</span><span style='color: rgb(0,0,0)'> System </span><br /><span style='color: rgb(0,0,255)'>Imports</span><span style='color: rgb(0,0,0)'> System.Collections </span><br /><span style='color: rgb(0,0,255)'>Imports</span><span style='color: rgb(0,0,0)'> System.Collections.Generic </span><br /> <br /><span style='color: rgb(0,0,255)'>Namespace</span><span style='color: rgb(0,0,0)'> EUNemopolis.Math </span><br /><span style='color: rgb(0,0,255)'> Public Class</span><span style='color: rgb(0,0,0)'> FibEnumerable2 </span><br /><span style='color: rgb(0,0,255)'> Inherits</span><span style='color: rgb(0,0,0)'> IntegerEnumerable </span><br />    <br /> <span style='color: rgb(0,0,255)'> Protected Overrides Function</span><span style='color: rgb(0,0,0)'> NewEnumerator() as IEnumerator </span><br />   return<span style='color: rgb(0,0,255)'> New</span><span style='color: rgb(0,0,0)'> FibEnumerator() </span><br /> <span style='color: rgb(0,0,255)'> End Function</span><span style='color: rgb(0,0,0)'> </span><hr>   <br />   <br />    <span style='color: rgb(0,0,255)'> Private Class</span><span style='color: rgb(0,0,0)'> FibEnumerator </span><br />    <span style='color: rgb(0,0,255)'> Inherits</span><span style='color: rgb(0,0,0)'> IntegerEnumerable.IntegerEnumerator </span><br />  <span style='color: rgb(0,0,255)'> Private</span><span style='color: rgb(0,0,0)'> const MAXN</span><span style='color: rgb(0,0,255)'> As Integer</span><span style='color: rgb(0,0,0)'> =45 </span><span style='color: rgb(51,153,51)'>'The maximum n for which Fib(n) fits in an integer </span><br />  <span style='color: rgb(0,0,255)'> Private</span><span style='color: rgb(0,0,0)'> _n</span><span style='color: rgb(0,0,255)'> As Integer</span><span style='color: rgb(0,0,0)'> </span><br />    <br />  <span style='color: rgb(0,0,255)'> Private</span><span style='color: rgb(0,0,0)'> Readonly</span><span style='color: rgb(0,0,255)'> Shared</span><span style='color: rgb(0,0,0)'> GoldenRation as</span><span style='color: rgb(153,0,204)'> Double</span><span style='color: rgb(0,0,0)'> = _  </span><br />   (1.0 + System.Math.Sqrt(5.0)) / 2.0 <br />      <br />  <span style='color: rgb(0,0,255)'> Public Function</span><span style='color: rgb(0,0,0)'> MoveNext()</span><span style='color: rgb(0,0,255)'> As</span><span style='color: rgb(153,0,204)'> Boolean</span><span style='color: rgb(0,0,0)'> _ </span><br />  <span style='color: rgb(0,0,255)'> Implements</span><span style='color: rgb(0,0,0)'> System.Collections.IEnumerator.MoveNext </span><br />       if _n&lt;MAXN then <br />        _n=_n+1 <br />        if _n&lt;2 then <br />         SetCurrent(_n) <br />        else <br />        <span style='color: rgb(0,0,255)'> Dim</span><span style='color: rgb(0,0,0)'> newCurrent as</span><span style='color: rgb(0,0,255)'> Integer</span><span style='color: rgb(0,0,0)'> </span><br />         newCurrent= _ <br />         System.Math.Floor((System.Math.Pow(GoldenRation, _n) - _  <br />         System.Math.Pow((1.0 - GoldenRation), _n)) / _ <br />         System.Math.Sqrt(5.0)) <br />         SetCurrent(newCurrent) <br />       <span style='color: rgb(0,0,255)'> End If</span><span style='color: rgb(0,0,0)'> </span><br />       <span style='color: rgb(0,0,255)'> Return</span><span style='color: rgb(0,0,0)'> True </span><br />      <span style='color: rgb(0,0,255)'> Else</span><span style='color: rgb(0,0,0)'> </span><br />       <span style='color: rgb(0,0,255)'> Return</span><span style='color: rgb(0,0,0)'> False </span><br />      <span style='color: rgb(0,0,255)'> End If</span><span style='color: rgb(0,0,0)'> </span><br />     <span style='color: rgb(0,0,255)'> End Function</span><span style='color: rgb(0,0,0)'> </span><hr>       <br />  <span style='color: rgb(0,0,255)'> Protected Overrides Sub</span><span style='color: rgb(0,0,0)'> Init() </span><br />   <span style='color: rgb(51,153,51)'>'illegal value first. Foreach does a movenext </span><br />   <span style='color: rgb(51,153,51)'>'first before reading current value </span><br />    _n=-1  <br />    SetCurrent(_n) <br />  <span style='color: rgb(0,0,255)'> End Sub</span><span style='color: rgb(0,0,0)'> </span><hr>    <span style='color: rgb(0,0,255)'> End Class</span><span style='color: rgb(0,0,0)'> </span><hr>   <span style='color: rgb(0,0,255)'> End Class</span><span style='color: rgb(0,0,0)'> </span><hr><span style='color: rgb(0,0,255)'>End Namespace</span><span style='color: rgb(0,0,0)'> </span><br /></pre><p>To see whether this gives the same result as the original implementation I altered my main program. I walk the sequence for n=0 up to and including n=45 for both implementations. I cache the results for the first implementation. In the second foreach loop I print the results for both implementations and the difference between them. If all is correct all differences should be zero. I can use both a list or a simple array for storing the results. I choose an array here just for having used array in VB.Net. I never use arrays in C#.  <pre><span style='color: rgb(51,153,51)'>' Application.vb created with MonoDevelop </span><br /><span style='color: rgb(51,153,51)'>' User: kruse at 9:50 20-1-2009 </span><br /><span style='color: rgb(51,153,51)'>' </span><br /><span style='color: rgb(51,153,51)'>' To change standard headers go to Edit-&gt;Preferences-&gt;Coding-&gt;Standard Headers </span><br /><span style='color: rgb(51,153,51)'>' </span><br /><span style='color: rgb(0,0,255)'>Imports</span><span style='color: rgb(0,0,0)'> System.Collections </span><br /><span style='color: rgb(0,0,255)'>Imports</span><span style='color: rgb(0,0,0)'> System.Collections.Generic </span><br /><span style='color: rgb(0,0,255)'>Imports</span><span style='color: rgb(0,0,0)'> EUNemopolis.Math </span><br />NameSpace EUNemopolis <br /> <br /><span style='color: rgb(0,0,255)'>Public Class</span><span style='color: rgb(0,0,0)'> Application </span><br /><span style='color: rgb(0,0,255)'> Public Shared Sub</span><span style='color: rgb(0,0,0)'> Main() </span><br />  System.Console.WriteLine("Hello world!") <br />    <span style='color: rgb(0,0,255)'> Dim</span><span style='color: rgb(0,0,0)'> fibseq as IEnumerable(Of</span><span style='color: rgb(0,0,255)'> Integer</span><span style='color: rgb(0,0,0)'>)=new FibEnumerable() </span><br />    <span style='color: rgb(0,0,255)'> Dim</span><span style='color: rgb(0,0,0)'> fib as</span><span style='color: rgb(0,0,255)'> Integer</span><span style='color: rgb(0,0,0)'> </span><br />    <span style='color: rgb(0,0,255)'> Dim</span><span style='color: rgb(0,0,0)'> cache(45) as</span><span style='color: rgb(0,0,255)'> Integer</span><span style='color: rgb(0,0,0)'> </span><br /> <span style='color: rgb(0,0,255)'> Dim</span><span style='color: rgb(0,0,0)'> i as</span><span style='color: rgb(0,0,255)'> Integer</span><span style='color: rgb(0,0,0)'> </span><br />  i=-1 <br />     for each fib in fibseq <br />      i=i+1 <br />      cache(i)=fib <br />     next <br />     fibseq=new FibEnumerable2() <br />     i=-1 <br />     for each fib in fibseq <br />      i=i+1 <br />      cache(i)=fib <br />      System.Console.Writeline(String.Format("{0:d},{1:d},{2:d},{3:d}",i,fib,cache(i),fib-cache(i))) <br />     next <br /><span style='color: rgb(0,0,255)'> End Sub</span><span style='color: rgb(0,0,0)'> </span><hr><span style='color: rgb(0,0,255)'>End Class</span><span style='color: rgb(0,0,0)'> </span><hr><span style='color: rgb(0,0,255)'>End</span><span style='color: rgb(0,0,0)'> NameSpace </span><br /></pre><p>And indeed the algorithm is correct for n=0 upto and including n=45. When you run it you will see always zero  as the last value of the print statement. </p><p>