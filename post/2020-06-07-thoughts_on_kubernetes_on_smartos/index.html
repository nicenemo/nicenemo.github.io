<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:title" content="Thoughts on Kubernetes on SmartOS"><meta property="og:description" content="With this blog post I document the thoughts I had in  getting Ubuntu server running from scratch on SmartOS using BHyve, the BSD Hypervisor. My final goal is getting Kubernetes running on SmartOS."><meta property="og:type" content="article"><meta property="og:url" content="https://hanskruse.eu/post/2020-06-07-thoughts_on_kubernetes_on_smartos/"><meta property="article:published_time" content="2020-06-07T17:48:25+02:00"><meta property="article:modified_time" content="2020-06-07T17:48:25+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Thoughts on Kubernetes on SmartOS"><meta name=twitter:description content="With this blog post I document the thoughts I had in  getting Ubuntu server running from scratch on SmartOS using BHyve, the BSD Hypervisor. My final goal is getting Kubernetes running on SmartOS."><title>Thoughts on Kubernetes on SmartOS | Hans Kruse</title><link rel=icon type=image/png href=https://hanskruse.eu/images/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://hanskruse.eu/images/favicon-32x32.png sizes=32x32><link href="https://fonts.googleapis.com/css?family=Oswald:400" rel=stylesheet><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://hanskruse.eu/css/bundle.min.b97f193de70a99ff0493bab9f65bdc1a4620f1d92b801069ccd3b39cd1f972f5.css integrity="sha256-uX8ZPecKmf8Ek7q59lvcGkYg8dkrgBBpzNOznNH5cvU="><link rel=icon type=image/png href=https://hanskruse.eu/images/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://hanskruse.eu/images/favicon-32x32.png sizes=32x32><link rel=alternate type=application/rss+xml href=https://hanskruse.eu/index.xml><meta charset=utf-8><meta name=author content="Hans Kruse"><meta name=copyright content="Copyright © 2014–2020, Hans Kruse  all rights reserved."><meta name=description content="With this blog post I document the thoughts I had in getting Ubuntu server running from scratch on SmartOS using BHyve, the BSD Hypervisor. My final goal is getting Kubernetes running on SmartOS."></head><body><nav class="navbar fixed-top navbar-expand-md navbar-dark bg-dark py-1 top-nav"><div class=container><a class="navbar-brand pr-2" href=https://hanskruse.eu/>HANS KRUSE</a>
<button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-bars"></i></button><div class="navbar-collapse collapse" id=navbarCollapse><ul class="navbar-nav mr-auto"><li class=nav-item><a class="nav-link active" href=https://hanskruse.eu/about/>About</a></li><li class=nav-item><a class="nav-link active" href=https://resume.hanskruse.eu>Resume</a></li></ul><div class="social-icons d-none d-lg-block"><a class="py-2 px-2" href=https://hanskruse.eu/index.xml><i class="fas fa-rss"></i></a></div></div></div></nav><header class="feature-image d-print-none"></header><div class=main><div class="container mt-4 post"><h1>Thoughts on Kubernetes on SmartOS</h1><div class=mb-3><small><strong>By Hans Kruse</strong>
| <i class="far fa-calendar-alt"></i>&nbsp;Jun 7, 2020&nbsp;
| <i class="fa fa-tags" title=Tags aria-hidden=true></i><a href=https://hanskruse.eu/tags/home-automation/>home-automation</a>, <a href=https://hanskruse.eu/tags/annoying/>annoying</a>, <a href=https://hanskruse.eu/tags/virtualization/>virtualization</a>, <a href=https://hanskruse.eu/tags/kubernetes/>kubernetes</a>, <a href=https://hanskruse.eu/tags/docker/>docker</a>, <a href=https://hanskruse.eu/tags/smartos/>smartos</a></small></div><div class="share-icons d-flex justify-content-center d-print-none"><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fhanskruse.eu%2fpost%2f2020-06-07-thoughts_on_kubernetes_on_smartos%2f&text=Thoughts%20on%20Kubernetes%20on%20SmartOS&tw_p=tweetbutton" class=p-2 title="Share on Twitter" target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Tweet</small></div></a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fhanskruse.eu%2fpost%2f2020-06-07-thoughts_on_kubernetes_on_smartos%2f&t=Thoughts%20on%20Kubernetes%20on%20SmartOS" class=p-2 title="Share on Facebook" target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Share</small></div></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fhanskruse.eu%2fpost%2f2020-06-07-thoughts_on_kubernetes_on_smartos%2f&title=Thoughts%20on%20Kubernetes%20on%20SmartOS&source=mattbutton.com" class=p-2 title="Share on LinkedIn" target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Share</small></div></a><a href=javascript:window.print() title="Print this article" class=p-2 target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fa fa-print fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Print</small></div></a></div><div class="mt-4 mb-4 main-content"><p>With this blog post I document the thoughts I had in getting Ubuntu server running from scratch on <a href=https://en.wikipedia.org/wiki/SmartOS>SmartOS</a> using <a href=https://bhyve.org/>BHyve</a>, the BSD Hypervisor. My final goal is getting <a href=https://kubernetes.io/>Kubernetes</a> running on SmartOS.</p><p>At home, I run SmartOS on a PC, that I use as a little NAS and for some server tasks.
It is low energy but has the power to run some virtualization tasks. Specifications:</p><ul><li>Intel I7 T series 35 Watt TDP, Passive cooled</li><li>32 Gb memory</li><li>2X 2 TB disks, <a href=https://en.wikipedia.org/wiki/ZFS>ZFS</a>, mirrored</li><li>SSD as ZFS log device</li><li>boot from USB stick</li><li>Passive cooled CPU</li><li>Big tower case with big slow turning fans</li></ul><p>SmartOS is a free and open-source hypervisor platform supporting several flavours of virtualization. The typical light-weight zone is Solaris based, Light-weight, Linux based zones, LX zones are also possible. It is even possible to run single Docker images. KVM or the newer BHyve zones allows running arbitrary operating systems using hardware virtualization. To increase security, these run inside a zone too with minimal privileges. People use SmartOS to virtualize BSD, Linux, Windows and even BeOS or HaikuOS. A while ago I even saw some odd QEmu based virtualizations.</p><p>Nowadays the lingua franca of virtualization is <a href=https://kubernetes.io/>Kubernetes</a>. Kubernetes is a Linux based solution for automating deployment, scaling, and management of containerized applications. It runs in the cloud on Google, Azure and AWS. On your PC or Mac you can run it with <a href=https://www.docker.com/products/docker-desktop>Docker Desktop</a> or <a href=https://kubernetes.io/docs/tutorials/hello-minikube/>MiniKube</a>.</p><p>SmartOS does not run Kubernetes natively. With <a href=https://www.joyent.com/triton/compute>Triton</a>, <a href=https://www.joyent.com/>Joyent</a>, now Samsung, tried/tries to offer a competing premium solution, on top of SmartOS. It never gained a lot of traction. Nowadays Triton can run Kubernetes, I know. You can run simple Docker containers in SmartOS after a conversion to an LX zone. However, a simple combination of docker images with configured <em>docker-compose</em> is not possible.</p><p>Triton, formerly called SmartDC, is cool but requires way more hardware resources than I like to spend on managing containers. Currently, I do prefer not to wipe my current server for native Kubernetes, Triton or something else.</p><p>Earlier, I tried <a href=https://project-fifo.net/>Project Fifo</a>, a lighter Triton alternative, that runs on bare SmartOS. Fifo is way more than I need and still consumes too many resources for managing virtualization on my home server.</p><p>A couple of years ago, I tried virtualization of Windows and Linux on SmartOS KVM.
For whatever reason KVM needs a gigabyte of extra memory that cannot be used.
My server is maxed out with 32Gb of memory. Losing a gigabyte of ram for every virtual machine is not attractive. So far I stayed with single LX and SmartOS zones. I never used my server for something complex. I use one LX zone with SMB NAS and a few other services.</p><p>Last year, I saw <a href=https://shaner.life/deploying-kubernetes-on-smartos/>this video</a> on the <em>Shaner&rsquo;s Life</em> blog, explaining how to run Kubernetes on SmartOS using the Bhyve hypervisor. He used several Ubuntu based images to virtualize a Kubernetes cluster. This seemed exactly what I needed. However, in 2019 I had other priorities.</p><p>It is now June 2020 and I really have a few use cases to run more complex Docker loads and maybe even Kubernetes. In the before mentioned video an existing Ubuntu server image for SmartOS was used. Sadly the latest KVM/BHyve Ubuntu images are from 2018. For LX zones it is even worse. SmartOS is not dead, I still see regular updates for the boot sticks but since Samsung bought Joyent, development seems a bit more silent.</p><p>I really fancy something newer than Ubuntu 2018 and maybe even lighter than a full-blown Ubuntu server. I decided to install Ubuntu from scratch and do a proof of concept with Kubernetes first. It is not that different from installing Windows on KVM or BHyve. If that works, I can look into using something lighter than Ubuntu. I did some experimenting and I can say that I was able to create an Ubuntu based server on BHyve using the Ubuntu server ISO. Main obstacles where, figuring out how to:</p><ul><li>mount a CD-ROM on a BHyve zone</li><li>remove CD-ROM from a BHyve zone after install</li><li>make the disk with Ubuntu bootable</li></ul><p>I read a few blog posts, man pages and combined a few ideas. After some trial and error I made it work! When, I finally managed to boot from CD-ROM, I saw the typical Ubuntu-server command line installer. (On the SmartOS VNC console). I was offered to install my GitHub or Ubuntu public key for password-less login. It also offered to install a lot of services. I only choose SSH, since most of the services offered where based on <a href=https://snapcraft.io/>Snap packages</a>. I am not sure whether I like that complexity for a Kubernetes host. Kubernetes was one of the Snaps offered. I decided to call it a day and safe my history for further scripting the installation after removing errors.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>hugo new post/ubuntu-server2020.04-on_SmartOS_with_BHyve.md
...
<span class=nb>history</span> &gt;&gt; post/ubuntu-server2020.04-on_SmartOS_with_BHyve.md
</code></pre></div><p>More in a next blog post after cleaning my history ;).</p><div class="share-icons d-flex justify-content-center d-print-none"><a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fhanskruse.eu%2fpost%2f2020-06-07-thoughts_on_kubernetes_on_smartos%2f&text=Thoughts%20on%20Kubernetes%20on%20SmartOS&tw_p=tweetbutton" class=p-2 title="Share on Twitter" target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Tweet</small></div></a><a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fhanskruse.eu%2fpost%2f2020-06-07-thoughts_on_kubernetes_on_smartos%2f&t=Thoughts%20on%20Kubernetes%20on%20SmartOS" class=p-2 title="Share on Facebook" target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Share</small></div></a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fhanskruse.eu%2fpost%2f2020-06-07-thoughts_on_kubernetes_on_smartos%2f&title=Thoughts%20on%20Kubernetes%20on%20SmartOS&source=mattbutton.com" class=p-2 title="Share on LinkedIn" target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Share</small></div></a><a href=javascript:window.print() title="Print this article" class=p-2 target=_blank rel=nofollow><div><span class=fa-stack><i class="fas fa-circle fa-stack-2x"></i><i class="fa fa-print fa-stack-1x fa-inverse"></i></span></div><div class="fa-inverse text-center"><small>Print</small></div></a></div></div></div><div class="sidebar d-print-none d-none d-xl-block"><h2>Hans Kruse</h2><div>Monadic programmer - Software Engineer with a passion for cooking.</div><a href=https://hanskruse.eu/about/ class="btn btn-outline-secondary mt-3" role=button>Read More...</a><h2 class=mt-4>Top Posts</h2><h2 class=mt-4>Recent Posts</h2><nav class="nav flex-column"><a href=https://hanskruse.eu/post/2020-06-07-thoughts_on_kubernetes_on_smartos/ class=nav-link>Thoughts on Kubernetes on SmartOS</a>
<a href=https://hanskruse.eu/post/2020-05-23-keys_to_your_fingers/ class=nav-link>Move the keys to your fingers</a>
<a href=https://hanskruse.eu/post/2018-09-04-vanilla-java/ class=nav-link>Vanilla Java for stream copy</a></nav><h2 class="mt-4 text-capitalize">categories</h2><nav class="nav flex-column"></nav><h2 class="mt-4 text-capitalize">tags</h2><nav class="nav flex-column"><a href=https://hanskruse.eu/tags/annoying/ class=nav-link>annoying
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/docker/ class=nav-link>docker
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/ergonomics/ class=nav-link>ergonomics
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/gear/ class=nav-link>gear
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/home-automation/ class=nav-link>home-automation
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/java/ class=nav-link>java
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/kubernetes/ class=nav-link>kubernetes
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/programming/ class=nav-link>programming
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/smart-working/ class=nav-link>smart-working
<span class="badge badge-pill badge-secondary">1</span></a>
<a href=https://hanskruse.eu/tags/smartos/ class=nav-link>smartos
<span class="badge badge-pill badge-secondary">1</span></a></nav></div></div><footer class="mt-auto footer d-print-none"><div class=container-fluid><div class="row justify-content-center"><div class="col-md-4 col-xl-3"><h5>Copyright © 2014–2020, Hans Kruse all rights reserved.</h5>Feel free to share this content non commercially, Attribution-NonCommercial-ShareAlike</div><div class="col-md-4 col-xl-3"><h5>Disclaimer</h5>Opinions expressed here are my own and may not reflect those of the company I work for, or the people I work with.</div><div class="col-md-4 col-xl-3"><h5>About This Site</h5>This blog was created using the <a href=https://gohugo.io/>Hugo</a> static site generator, using
<a href=https://getbootstrap.com/>Bootstrap</a>, using the Silhouette Hugo theme, created by
<a href=https://www.mattbutton.com>Matt Button</a></div></div><hr><div class="d-flex justify-content-center icons"><a class="py-2 px-2" href=https://hanskruse.eu/index.xml><i class="fas fa-rss"></i></a></div></div></footer><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script></body></html>